<!DOCTYPE html>
<html>
<head>
  <title>CareAI</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gray-100 flex flex-col items-center justify-center p-10">

  <h1 class="text-3xl font-bold mb-2">CareAI</h1>
  <p class="mb-6 text-gray-600">Understand your parentsâ€™ medical reports. From anywhere.</p>

  <div class="bg-white p-6 rounded-xl shadow-md w-full max-w-xl">

    <input type="file" id="file" class="mb-2"/>

    <button onclick="send()" class="w-full bg-black text-white py-2 rounded">
      Analyze Report
    </button>

    <button onclick="demo()" class="mt-3 w-full text-sm underline text-center text-blue-600">
      Use sample report
    </button>

    <div id="result" class="mt-6 text-sm text-gray-800"></div>

  </div>

  <div class="mt-6 text-gray-400 text-sm">
    ðŸš§ Coming Soon: Care Coordination â€¢ Emergency Alerts â€¢ Expense Tracking
  </div>

  <script>
    async function send() {
      const file = document.getElementById("file").files[0];

      if (!file) {
        alert("Upload a file first or use sample!");
        return;
      }

      const fd = new FormData();
      fd.append("file", file);

      document.getElementById("result").innerText = "Analyzing...";

      try {
        const res = await fetch("https://expo-backend-xzca.onrender.com/analyze", {
          method: "POST",
          body: fd
        });

        if (!res.ok) {
          document.getElementById("result").innerText = "Error from backend: " + res.status;
          return;
        }

        const data = await res.json();

        document.getElementById("result").innerHTML =
          "<div class='space-y-3'>" +
          data.result.replace(/\n/g, "<br>") +
          "</div>";

      } catch (e) {
        console.error("Fetch failed:", e);
        document.getElementById("result").innerText = "Backend unreachable";
      }
    }

    async function demo() {
      const sampleText = `Patient complains of persistent cough for 2 weeks. No fever. Mild shortness of breath. Prescribed cough syrup. Chest X-ray advised.`;

      const fd = new FormData();
      fd.append("file", new Blob([sampleText], { type: "text/plain" }), "sample.txt");

      document.getElementById("result").innerText = "Analyzing sample...";

      try {
        const res = await fetch("https://expo-backend-xzca.onrender.com/analyze", {
          method: "POST",
          body: fd
        });

        if (!res.ok) {
          document.getElementById("result").innerText = "Error from backend: " + res.status;
          return;
        }

        const data = await res.json();

        document.getElementById("result").innerHTML =
          "<div class='space-y-3'>" +
          data.result.replace(/\n/g, "<br>") +
          "</div>";

      } catch (e) {
        console.error("Fetch failed:", e);
        document.getElementById("result").innerText = "Backend unreachable";
      }
    }
  </script>

</body>
</html>
